<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Steps to compile the workshop firmware for M5STICKC (ESP32) | Amazon FreeRTOS Workshop</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Steps to compile the workshop firmware for M5STICKC (ESP32)" />
<meta name="author" content="teuteuguy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Amazon Freertos workshop using the M5 StickC" />
<meta property="og:description" content="Amazon Freertos workshop using the M5 StickC" />
<link rel="canonical" href="http://localhost:4200/setup/compileworkshopcode" />
<meta property="og:url" content="http://localhost:4200/setup/compileworkshopcode" />
<meta property="og:site_name" content="Amazon FreeRTOS Workshop" />
<script type="application/ld+json">
{"description":"Amazon Freertos workshop using the M5 StickC","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Amazon_Web_Services_Logo.svg/1280px-Amazon_Web_Services_Logo.svg.png"},"name":"teuteuguy"},"@type":"WebPage","headline":"Steps to compile the workshop firmware for M5STICKC (ESP32)","url":"http://localhost:4200/setup/compileworkshopcode","author":{"@type":"Person","name":"teuteuguy"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=e9b439637ae65e011d9f7e9bab5bec5c827ff7b2">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 style="font-size: 18px;"><a href="http://localhost:4200/">Amazon FreeRTOS Workshop</a></h1>
        
        
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Amazon_Web_Services_Logo.svg/1280px-Amazon_Web_Services_Logo.svg.png" alt="Logo" />
        

        <p>Amazon Freertos workshop using the M5 StickC</p>

        <ul class="content-menu">
          
          <li>
            <a href="/lab/2019/11/01/lab-0.html">Lab 0 - Setup</a>
          </li>
          
          <li>
            <a href="/lab/2019/11/01/lab-1.html">Lab 1 - Create your own AWS IoT Button</a>
          </li>
          
          <li>
            <a href="/lab/2019/11/01/lab-2.html">Lab 2 - Interract with the Thing</a>
          </li>
          
          <li>
            <a href="/lab/2019/11/01/lab-3.html">Lab 3 - Alexa</a>
          </li>
          
        </ul>

        
        <p class="view"><a href="https://github.com/teuteuguy/amazon-freertos-m5stickc-workshop">View the Project on GitHub <small>teuteuguy/amazon-freertos-m5stickc-workshop</small></a></p>
        

        

        
      </header>
      <section>

      <h1 id="steps-to-compile-the-workshop-firmware-for-m5stickc-esp32">Steps to compile the workshop firmware for M5STICKC (ESP32)</h1>

<h2 id="clone-the-repo">Clone the repo</h2>

<p>In your Cloud9 terminal environment, clone the lab repo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/environment
git clone https://github.com/teuteuguy/amazon-freertos-m5stickc-workshop.git <span class="nt">--recurse-submodules</span> workshop
</code></pre></div></div>

<h2 id="setup-your-credentials">Setup your credentials</h2>

<h3 id="create-the-aws_clientcredential_keysh">Create the aws_clientcredential_keys.h</h3>

<p>Navigate to <a href="https://yona75.github.io/credformatter/">https://yona75.github.io/credformatter/</a>, upload your Certificate and Private key that you downloaded in the <a href="./iotcoresetup.html">previous</a> step and generate an aws_clientcredential_keys.h file.</p>

<h3 id="copy-aws_clientcredential_keysh-to-project">Copy aws_clientcredential_keys.h to project</h3>

<p>Copy the file to ~/environment/workshop/amazon-freertos/demos/include/ directory by dragging it there</p>

<p><img src="/assets/images/workshop-copy-cred-file.png" alt="Copy aws_clientcredential_keys.h" /></p>

<h3 id="edit-aws_clientcredentialh">Edit aws_clientcredential.h</h3>

<p>Open the aws_clientcredential.h file by double-clicking on it. And change the following values:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="c">#define clientcredentialMQTT_BROKER_ENDPOINT "[YOUR AWS IOT ENDPOINT]"</span>
...
<span class="c">#define clientcredentialIOT_THING_NAME "[THE THINGNAME YOU CREATED]"</span>
...
<span class="c">#define clientcredentialWIFI_SSID       "[WILL BE PROVIDED]"</span>
...
<span class="c">#define clientcredentialWIFI_PASSWORD   "[WILL BE PROVIDED]"</span>
...
<span class="c">#define clientcredentialWIFI_SECURITY   eWiFiSecurityWPA2</span>
...
</code></pre></div></div>

<blockquote>
  <p>Note: clientcredentialWIFI_SECURITY is defined without double quotes</p>
</blockquote>

<h2 id="setup-the-code">Setup the code</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> ~/environment/workshop/m5stickc ~/environment/workshop/amazon-freertos/vendors/espressif/boards
</code></pre></div></div>

<h2 id="configure-the-code">Configure the code</h2>

<p>Run make menuconfig and simply exit. This will setup the defaults.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/environment/workshop/amazon-freertos/vendors/espressif/boards/m5stickc/aws_demos

make menuconfig
</code></pre></div></div>

<p>Click <em>Save</em> and then <em>Exit</em></p>

<p><img src="/assets/images/cdd-make-menuconfig.png" alt="make menuconfig" /></p>

<h2 id="compile-the-code">Compile the code</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make all <span class="nt">-j4</span>
</code></pre></div></div>

<p>If compilation is successful, you should be greeted with the following message:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esptool.py v2.6
To flash all build output, run <span class="s1">'make flash'</span> or:
python /home/ec2-user/environment/workshop/amazon-freertos/vendors/espressif/esp-idf/components/esptool_py/esptool/esptool.py <span class="nt">--chip</span> esp32 <span class="nt">--port</span> /dev/cu.usbserial-29568143B4 <span class="nt">--baud</span> 1500000 <span class="nt">--before</span> default_reset <span class="nt">--after</span> hard_reset write_flash <span class="nt">-z</span> <span class="nt">--flash_mode</span> dio <span class="nt">--flash_freq</span> 40m <span class="nt">--flash_size</span> detect 0x1000 /home/ec2-user/environment/workshop/amazon-freertos/vendors/espressif/boards/m5stickc/aws_demos/build/bootloader/bootloader.bin 0x20000 /home/ec2-user/environment/workshop/amazon-freertos/vendors/espressif/boards/m5stickc/aws_demos/build/aws_demo.bin 0x8000 /home/ec2-user/environment/workshop/amazon-freertos/vendors/espressif/boards/m5stickc/aws_demos/build/partition-table.bin
</code></pre></div></div>

<h2 id="download-the-binary-files">Download the binary files</h2>

<p>Once compilation is done, download these 3 files to your local computer:</p>

<ul>
  <li><em>build/aws_demos.bin</em></li>
  <li><em>build/partitions_example.bin</em></li>
  <li><em>build/bootloader/bootloader.bin</em></li>
</ul>

<p><img src="/assets/images/workshop-download.png" alt="download bin files from Cloud9" /></p>

<blockquote>
  <p>Note: the “build” folder is located in ~/environment/workshop/amazon-freertos/vendors/espressif/boards/m5stickc/aws_demos/build</p>
</blockquote>

<h2 id="next-step">Next Step</h2>

<p><a href="./flashing.html">Flash and monitor the code</a></p>



      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/teuteuguy">teuteuguy</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
  </body>
</html>
